#!/usr/bin/env python3
"""
Fix Remaining English Text

This script directly targets the specific English text patterns
that you identified as still needing translation.
"""

import os
import re

def fix_english_text(file_path, language_code):
    """Fix remaining English text in a specific file"""
    
    print(f"üîÑ Processing {file_path} for {language_code.upper()} remaining English text...")
    
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Track changes
        changes_made = 0
        
        # Direct replacements based on your examples
        replacements = {}
        
        if language_code == 'pt':
            replacements = {
                # Insights explanations
                "Some insights show LIVE data, BETA insights are work in progress (might have false positives), others display placeholder content.": "Alguns insights mostram dados AO VIVO, insights BETA est√£o em desenvolvimento (podem ter falsos positivos), outros exibem conte√∫do de placeholder.",
                
                # Performance issues
                "Inefficient Index Scans": "Varreduras de √çndice Ineficientes",
                "Slow Index Scan Times": "Tempos Lentos de Varredura de √çndice",
                "Primary Index Over-Usage": "Uso Excessivo de √çndice Prim√°rio",
                "High Kernel Time in Queries": "Alto Tempo de Kernel em Consultas",
                "High Memory Usage Detected": "Alto Uso de Mem√≥ria Detectado",
                "Slow USE KEY Queries": "Consultas USE KEY Lentas",
                "Missing WHERE Clauses": "Cl√°usulas WHERE Ausentes",
                "Complex JOIN Operations": "Opera√ß√µes JOIN Complexas",
                "Inefficient LIKE Operations": "Opera√ß√µes LIKE Ineficientes",
                "Large Payload Streaming": "Streaming de Payload Grande",
                "Large Result Set Queries": "Consultas com Conjunto de Resultados Grandes",
                "Timeout-Prone Queries": "Consultas Propensas a Timeout",
                "Concurrent Query Conflicts": "Conflitos de Consultas Concorrentes",
                
                # Technical explanations - will be translated to simpler Portuguese
                "queries scan an average of": "consultas verificam uma m√©dia de",
                "index entries but returned back an avg": "entradas de √≠ndice mas retornaram uma m√©dia de",
                "records per query or a selectivity of": "registros por consulta ou uma seletividade de",
                "excluding aggregate functions like COUNT(), AVG(), MIN(), MAX()": "excluindo fun√ß√µes agregadas como COUNT(), AVG(), MIN(), MAX()",
                "total indexes:": "√≠ndices totais:",
                "indexes with an avg scan time between": "√≠ndices com tempo m√©dio de varredura entre",
                "indexes with an avg scan time of": "√≠ndices com tempo m√©dio de varredura de",
                "#primary indexes with an avg scan time of": "√≠ndices #primary com tempo m√©dio de varredura de",
                "Primary indexes on avg are scanning": "Os √≠ndices prim√°rios em m√©dia est√£o verificando",
                "items with an avg scan time of": "itens com tempo m√©dio de varredura de",
                "These could benefit from secondary indexes": "Estes poderiam se beneficiar de √≠ndices secund√°rios",
                "queries whose average percentage of sum of their": "consultas cuja porcentagem m√©dia da soma de seu",
                "tempo de execu√ß√£o principal": "tempo de execu√ß√£o principal",  # Keep this as is
                "core execTime": "tempo de execu√ß√£o principal",
                "queries are using avg": "consultas est√£o usando uma m√©dia de",
                "of memory each, indicating potential memory optimization opportunities": "de mem√≥ria cada, indicando oportunidades potenciais de otimiza√ß√£o de mem√≥ria",
                "USE KEY queries with avg query time of": "consultas USE KEY com tempo m√©dio de consulta de",
                "suggesting potential KV service bottlenecks": "sugerindo poss√≠veis gargalos do servi√ßo KV",
                "lack WHERE clauses, potentially scanning entire collections unnecessarily": "carecem de cl√°usulas WHERE, potencialmente verificando cole√ß√µes inteiras desnecessariamente",
                "are taking an average of": "est√£o levando uma m√©dia de",
                "seconds each, with": "segundos cada, com",
                "showing suboptimal join patterns": "mostrando padr√µes de jun√ß√£o sub√≥timos",
                "use LIKE operations with leading wildcards": "usam opera√ß√µes LIKE com wildcards iniciais",
                "preventing index usage and causing full scans": "impedindo o uso de √≠ndice e causando varreduras completas",
                "queries with avg size:": "consultas com tamanho m√©dio:",
                "of the time of the query was streaming data out to the application": "do tempo da consulta foi gasto transmitindo dados para a aplica√ß√£o",
                "return result sets with avg size of": "retornam conjuntos de resultados com tamanho m√©dio de",
                "which can consume significant memory and network resources": "o que pode consumir mem√≥ria significativa e recursos de rede",
                "are consistently approaching timeout thresholds, with": "est√£o consistentemente se aproximando dos limites de timeout, com",
                "actually timing out in the analyzed period": "realmente expirando no per√≠odo analisado",
                "show evidence of resource contention, with execution times varying by more than": "mostram evid√™ncia de conten√ß√£o de recursos, com tempos de execu√ß√£o variando em mais de",
                "during peak hours": "durante as horas de pico",
                
                # Status badges and labels
                "Live": "Ao Vivo",
                "Beta": "Beta", 
                "Dev": "Desenvolvimento",
                
                # Index tab content
                "Search:": "Buscar:",
                "Bucket:": "Bucket:",
                "Scope:": "Escopo:",
                "Collection:": "Cole√ß√£o:",
                "Sort By:": "Ordenar Por:",
                "Total Indexes:": "√çndices Totais:",
                "Buckets:": "Buckets:",
                "Scopes:": "Escopos:",
                "Collections:": "Cole√ß√µes:",
                "Primary Indexes:": "√çndices Prim√°rios:",
                "Primary Only": "Apenas Prim√°rios",
                "Used/Total Indexes:": "√çndices Usados/Totais:",
                "Used Only": "Apenas Usados",
                "Without/With Replica:": "Sem/Com R√©plica:",
                "No Replicas Only": "Apenas Sem R√©plicas", 
                "Never Scanned Indexes:": "√çndices Nunca Verificados:",
                "Never Scanned Only": "Apenas Nunca Verificados",
                "Exclude Mobile Indexes": "Excluir √çndices M√≥veis",
                "Nenhum dado de √≠ndice carregado": "Nenhum dado de √≠ndice carregado",  # Already translated
            }
        
        elif language_code == 'es':
            replacements = {
                # Similar translations for Spanish
                "Some insights show LIVE data, BETA insights are work in progress (might have false positives), others display placeholder content.": "Algunos insights muestran datos EN VIVO, insights BETA est√°n en desarrollo (pueden tener falsos positivos), otros muestran contenido de marcador de posici√≥n.",
                
                "Inefficient Index Scans": "Escaneos de √çndice Ineficientes",
                "Slow Index Scan Times": "Tiempos Lentos de Escaneo de √çndice",
                "Primary Index Over-Usage": "Uso Excesivo de √çndice Primario",
                # Add more Spanish translations...
            }
        
        elif language_code == 'de':
            replacements = {
                # Similar translations for German
                "Some insights show LIVE data, BETA insights are work in progress (might have false positives), others display placeholder content.": "Einige Erkenntnisse zeigen LIVE-Daten, BETA-Insights sind in Entwicklung (k√∂nnen falsche Positive haben), andere zeigen Platzhalterinhalt.",
                
                "Inefficient Index Scans": "Ineffiziente Index-Scans",
                "Slow Index Scan Times": "Langsame Index-Scan-Zeiten",
                "Primary Index Over-Usage": "√úberm√§√üige Prim√§rindex-Nutzung",
                # Add more German translations...
            }
        
        # Apply each replacement
        for english_text, translated_text in replacements.items():
            if english_text in content:
                content = content.replace(english_text, translated_text)
                changes_made += 1
                print(f"  ‚úÖ Translated: {english_text[:50]}...")
        
        # Write back if changes were made
        if changes_made > 0:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
            print(f"  üéâ Fixed {changes_made} remaining English texts in {file_path}")
        else:
            print(f"  ‚ÑπÔ∏è No remaining English text found in {file_path}")
            
        return changes_made
        
    except Exception as e:
        print(f"  ‚ùå Error processing {file_path}: {e}")
        return 0

def main():
    """Main function to fix remaining English text"""
    
    print("üåç Fixing Remaining English Text in Localized Files")
    print("=" * 60)
    
    # Files to process
    files_to_process = [
        ('de/index.html', 'de'),
        ('es/index.html', 'es'),
        ('pt/index.html', 'pt')
    ]
    
    total_changes = 0
    
    for file_path, language_code in files_to_process:
        if os.path.exists(file_path):
            changes = fix_english_text(file_path, language_code)
            total_changes += changes
        else:
            print(f"‚ö†Ô∏è File not found: {file_path}")
    
    print(f"\nüìä English Text Fix Summary:")
    print(f"   Total changes applied: {total_changes}")
    
    if total_changes > 0:
        print(f"\n‚úÖ Remaining English text has been fixed!")
        print(f"   üîç Run JavaScript validation: python3 settings/validate_js_syntax.py")
        print(f"   üìã Run release verification: python3 settings/RELEASE_WORK_CHECK.py 3.12.0")
    else:
        print(f"\n‚úÖ All English text is already properly translated!")

if __name__ == "__main__":
    main()
